---
title: 0-3 个人介绍
date: 2023-01-01 16:03:37
categories:
    - 社招
tags:
    - 社招
---

[toc]

# 1 个人信息
## 1.1 个人介绍
您好，我叫沈坤。我从5个方面介绍自己，包括：教育、工作、项目、能力、爱好

1. 第1，教育：我20年，毕业于北京邮电大学，信息安全专业，专业课程主要是，计算机基础课，与计算机安全课
2. 第2，工作：毕业到现在4年里，一直在华为的2012实验室，从事数据库内核开发，部门产品是GaussDB和openGauss，都是OLTP关系数据库，一个是分布式，一个是集中式。我主要参与安全相关的特性
3. 第3，项目：第1个特性是透明加密，由我独立设计与开发，在数据库存储模块，解决表级数据加密存储问题，。第2个特性是全密态数据库，在执行模块，基于可行执行环境，解决数据在密文上进行计算的问题。 
4. 第4，能力：我对数据库内核执行、存储多个模块，都有一定了解，可能存储更熟一点。同时，也熟悉数据库的各个安全特性。另外，也有一点后端开发的基础。平时的工作、学习都和这三方向有关，
5. 第5，爱好：平时，会主动看介绍数据库源码书；比较喜欢写代码，比如自己从头实现一个数据库；也喜欢记录点博客。
然后就，介绍完了。

## 1.2 离职原因
- 高斯
    1. 地域原因：离家远，几乎无法回家，遇到家里有一些事，比如长辈身体不好，回家麻烦
    2. 工作原因：交付流程有点慢。我先说下背景，最近两年，几十个客户开始用我做的特性，比如透明加密，所以需求比较多。交付过程中，流程很慢：
        1. 需求、设计评审，需要十多个人评审，必须全部评审，才能走到下一环节，大部分人要催很多遍，需求多了，天天催，很难受
        2. 开发：开发周期短，很多特性一两个月开发。我们的功能比较多，我们过了信创二级，适配点很多。短时间学习和开发，且参考资料较少，代码注释少，压力大
            - 10多种表： 段页式表、压缩表、行存表、ustore表
            - 4套执行引擎
            - 2套存储接口
            - 3套xlog回访机制
            - 细粒度备份恢复、扩容、hashbucket扩容
        3. 交付：交付流程很重，多种部署形态，要跑10多种check，测试性能指标
        4. 维护：review gate：责任田不回复，直属领导也经常不回复
    3. 生活原因：如果考虑长期居住，落户、买车、摇号、买房等各方面
- 无线
    1. 工作强度：每天都是10点
    2. 新人培养：自己了解无线知识，自己熟悉交付流程，自己熟悉代码
    3. 个人兴趣：不喜欢无线，还是对数据库感兴趣

# 2 教育经历

# 3 工作经历
## 一、熟悉11个安全特性：
### 1. 透明加密
- 特性背景
    - 用户将数据发送给数据库后，数据库组织数据，并把数据存储在文件中
    - 虽然数据库提供身份认证等安全机制，但是攻击者绕过数据库，通过操作系统或其他软件的漏洞，可直接从磁盘中获取数据，造成数据泄露
- 特性原理：
    - 透明加密的功能：是解决数据加密存储问题
    - 他的原理是：在数据库将数据写到数据落盘时，先加密数据，再将数据密文落盘；
    - 合法用户读取数据时，数据库自动解密数据
    - 非法用户直接从磁盘窃取数据时，无法解密数据
- 用户角度来看，这个特性比较简单：
    1. 配置一些参数后
    2. 在CREATE TABLE/ALTER TALBE等语法中，可以为表设置加密属性
    3. 通过INSERT/UPDATE等语法存储数据时，用户感知不到加密过程。但是，如果从磁盘上看数据，会发现表对应的数据，都被加密了。
    4. 当然，使用SELETE等语法查询数据时，用户也感知不到解密过程。
- 从内核实现的角度来看，这个特性就更复杂一点，需要解决以下几点：
    - 第1，确定加密对象：用户向表中存储数据时，数据库除了将数据写表对应的文件外，为了提高性能、可靠性、可用性等，还会在很多地方记录数据，比如索引文件、redo日志文件、undo日志文件中
        - 还有一些比较特殊的，比如Tosat机制中，把数据存储到表文件之外的文件；双写机制，把数据存储到单独的文件。
    - 第2，确定加密范围：
    - 第3，确定加密时机：
    - 第4，自动管理密钥：
    - 第5，提高加密性能：
- 安全基础：
    1. 数据与密钥隔离，避免拖库：数据密文存储在数据库，关键的顶级密钥由独立的密钥服务管理
    2. 密钥凭证最小化：数据库进程拥有访问密钥服务的凭证
- 使用：

- 难点
    1. 熟悉存储机制：
        - 数据来源：INSERT、VACUUM、ALTER TABLESPACE
        - 数据组织：基表文件、索引文件、Toast表文件、分区表文件、分布式表文件
        - 数据管理：redo log、undo log、双写文件等
        - 数据存储规律：异步落盘，同步落盘，数据读写
    2. 确定影响范围：
        - redo log：故障恢复、主备同步、逻辑解码、物理备份、PITR恢复、扩容等
    3. 解决性能开销：加密redo log的开销，sm4加密的开销
- 遇到的问题
    1. 临时表localbuf落盘规律
- 友商
    1. oracle / sql server有透明加密，国内oceanbase等常见数据库也都有透明加密。关键在于加密粒度、加密redo log和undo log等

#### 面试问题
- 加密对象
    - 加密9种表：
        - astore, ustore
        - partition
            - 从内核角度，每个分区，都是一个独立的表，每个分区需要单独存储自己的元信息，包括是否加密、密钥等
        - toast
            - 从内核角度看，toast表也是一个独立的表，需要单独存储自己的元信息
        - temp, global-temp, unlogged
            - 数据存储在local buffer，某些场景，local buffer的落盘机制不一样
        - segment（原理）, hashbucket
    - 加密2种索引：
        - btree
        - ubtree
- 加密范围
    - 直接加密
        - 数据文件
        - redo-log：所有涉及写文件的操作，都会生成redo-log，redo-log按时间顺序，组织在一起。需要精准识别哪些redo-log属于加密表，也就是，只对部分表的redo-log进行加密
        - undo-log：与reod-log一样，所有表的undo-log都在一起，需精准识别属于部分表的undo-log
        - 双写文件：数据被写到对应的表文件之前，会被提前写到双写文件中，防止发生断电时，造成半页写的问题。因此，双写文件中也会存储数据
    - 间接加密
        - 业务线程，将xlog先加密，再写到wal buffer
        - wal-writer线程：将wal buffer中的reod-log，写到磁盘
        - wal-sender线程：读取redo-log文件，发送文件数据至其他节点
- 加密管理
    - 3级加密模型
        - 数据密钥加密数据文件
        - 主密钥加密数据密钥
        - 根密钥加密主密钥
    - 3种密钥服务
        - 公有云密钥服务
        - 混合云密钥服务
        - 私有云密钥服务
    - 5种加密算法
        - aes_128_ctr, aes_128_gcm, aes_ctr_sha256_hmac
        - sm4_ctr, sm4_ctr_sm3_hmac
- 6个高性能设计：
    - 缩短临界区（iv）：bgwriter线程数少，提前生成iv、存储加密元信息的操作
    - 降低加密次数（双写）：双写模块，拼接多个脏页，加密1次
    - 缓存密钥流（xlog）：频繁提交事务，频繁落盘redo-log，一次性生成8k密钥流
    - 异步加密（新线程）：提前生成IV，提前生成密钥流
    - 避免无效加密（主备复制）：在decode时解密，主备复制，无需解密。crc校验bypass
    - 加速缓存查找（hash表）：pg自带hash表，只能锁全表。以密钥第1字节为hash值，分256个桶。每个桶自己有锁
- 安全性、可用性、性能、膨胀、易用
- 有趣的点
    - 加密xlog，怎么识别xlog属于哪个表
    - 加密xlog，怎么提高性能，怎么优化性能
    - 加密xlog，有很多方案
- 难点
    - 短时间内，学习内核多个模块，熟悉处理数据的规律
        - 数据种类：表文件、索引文件、undo-log、redo-log、双写文件
            - 物理备份、逻辑解码等等
    - 加密xlog，提高性能
- 问题
    - localbuf落盘。uset，不知道跑了什么业务


### 2. 密态等值
- 背景
    - 应用需要将数据存储至数据库时，数据需要经过网络传输、数据库进程处理、磁盘存储等多个阶段
- 问题
    - 上述传输、计算、存储等多个环节，可能存在数据泄露问题
    - 传输有SSL，还好
    - 存储有透明加密，也还好
    - 一个比较典型的威胁是，云服务提供商不可信任，而且，数据库内存中的数据，也存在泄露的可能
- 解决
    - 针对特定的列：执行INSERT等语法，向表中存储数据时，在驱动端中，自动加密语法中的数据；
    - 执行SELECT等语法时，在驱动端自动解密查询结果中的数据
- 特点
    - 在驱动端，也就是客户的应用，可以加密与解密数据。除了驱动，只有数据库所在机器的机密计算环境可以解密，机密计算是由硬件、驱动、软件组成的安全的环境，攻击者无法造成攻击
- 使用
    1. 配置访问参数
    2. 定义密钥，创建表，定义加密列
    3. 向表中存储数据，驱动解析语法，加密语法中的数据
    4. 从表中读取数据，数据库将数据密文传输至机密计算环境中，在可信环境中解密，计算，又加密传输到数据库内存中
    5. 客户端接收到密文，解密密文
- 难点
    1. 可维护性：语法解析
    2. 可维护性：jdbc, libpq, python驱动，go驱动等
    1. 加密范围：识别SQL语法中的数据：INSERT、UPDATE等语法中数据的位置，语法解析
    2. 识别范围：识别后加密数据，客户端语义分析，检查是否加密，采用哪个密钥加密等；需要考虑不同的数据类型，使用不同的加密方法。
    3. 功能约束：比如DDL约束：ALTER COLUMN等，DML约束：SELECT INTO等，等值与非等值的约束
- 遇到的问题
    1. 不同数据类型，进行计算
- 友商
    1. Oracle没有，SQL Server有，做的比较好。PolarDB有，不过不太透明，数据类型需要手动指定。其他厂商没有

#### 面试问题
- 范围查询、模糊查询、内置函数计算
    - Scan算子，先扫描密文，再执行表达式
- 4个高性能设计：
    - 减少发给tee的数据：排序过滤条件，将明文过滤条件提前
    - 批量：减少与tee的交互数：批量过滤、批量调用内置函数
    - 通信：降低与tee的交互开销：引入共享内存机制，使用独立的共享内存分配算法
    - 异步：异步交互：数据发送给tee后，不阻塞等待

### 3. 机密计算
- 背景
    - 机密计算：
- 问题
    - 在密态等值查询特性中，数据库服务端接收到与存储的数据都是密文。假如用户发送一条范围查询，数据库服务端无法在密文上比较大小，无法处理范围查询
- 解决
    - 用户执行范围查询、模糊查询、排序、函数计算等操作时，服务端接受请求后，基于机密计算框架，将数据密文从数据库内存发送至可信执行环境中
    - 可行执行环境对数据进行解密，计算，并加密返回结算结果
    - 数据库驱动端解密数据
- 特点
    1. 数据明文只存在数据库驱动侧，可信执行环境侧，可有效解决所有安全攻击
- 使用
    1. 用户与数据库建立连接，然后与可信执行环境建立连接，用户通过可行通道，将数据密钥发送至可信执行环境中
    2. 数据库发送范围查询等请求时，服务端自动将密文运算操作传送至可信执行环境内
    3. 数据库驱动会自动解密可信环境返回的密文结果
- 难点
    1. 计算范围：识别所有的密文计算
    2. 计算性能：举一个例子，比如进行范围查询，在执行引擎，主要是SeqScan算子中，进行计算，每次扫描一个Tuple，都要与可行执行环境进行一次交互
    3. 生态问题：
- 友商
    1. 微软：机密计算，不知道具体进展，
    2. 阿里：polar db，功能较多，不过，不够透明

### 4. 安全传输
- 背景
    - 通常，用户的服务器与数据库部署在不同机器上，应用与数据库通信时，采用网络发送数据
- 问题
    - 应用服务器、服务器所在网络，数据库服务器、数据库所在网络，都可能存在窃听、伪造等攻击
- 解决
    - 基于SSL协议，实现通信的可认证性、机密性
- 使用
    1. 通信前：申请证书，配置证书
    2. 通信开始时：双方协商密钥
    3. 通信时：通过协商的密钥加密数据
- 难点
    1. 无
- 友商
    1. 无
    
### 5. 加密函数
- 背景
    - 用户将数据发送给数据库后，数据库按照一定方式组织用户数据，并把用户数据存储至表特定的表文件中，同时，为了提高性能、可靠性、可用性等，还可能在很多文件中记录用户数据，比如：索引文件、redo日志文件、undo日志文件、双写文件等，这些文件中，也会包含用户数据。
- 问题
    - 在数据库所在的机器上，攻击者通过操作系统或其他软件的漏洞，可直接从磁盘中获取数据，造成数据泄露
- 解决
    - 数据库提供内置的加密函数，应用向数据库插入数据时，主动调用加密函数加密数据，数据库现在执行模块对数据加密，在存储模块存储加密后的数据
- 使用
    1. 数据存储：用户存储数据时，在DML语句中，主动调用加密函数
    2. 数据读取：用户读取数据时，在DML语句中，主动调用解密函数
- 难点
    1. 从数据的角度看，用户在SQL语句中传入密钥，数据库运行日志，审计日志等可能记录SQL语句，需要对SQL语句中的敏感参数进行脱敏

### 6. 身份认证
- 背景
    - 数据库在主机上监听端口，只要网络环境通常，任何节点的可与数据库建立TCP连接
- 问题
    - 攻击者可尝试与数据建立TCP连接，并且让数据库执行SQL语句
- 解决
    - 合法的数据用户，需提供身份证明，比如密码、证书等
- 使用
    1. 生成凭据：管理员执行CREATE USER/ROLE等语句，创建用户，并为用户设置密码
    2. 身份鉴别：用户连接数据，为数据库提供密码，数据库通过判断密码是否正确，来确认是否是合法用户
- 难点
    1. 无

### 7. 访问控制
- 背景
    - 一个数据库系统中，存在多个用户，每个用户都可以创建自己的数据库对象，比如表、数据库之类的
- 问题
    - 在正常使用场景，用户之间应该相互隔离；在异常场景中，假如攻击者破解单个账号，访问的数据范围也是有限的
- 解决
    - 自主访问控制：主体创建客体，主体定义客体的可访问列表，客体存储可访问列表
    - 强制访问控制：主体具有安全等级，客体具有安全等级，根据安全等级确定是否可访问。机密性场景，下读上写；完整性场景，上读下写
    - 角色访问控制：将主体划分为不同角色，对角色权限进行定义，同一角色可访问同一个客体，主体存储权限列表
    - 规则访问控制：
- 特点
    1. 
- 使用
    1. 
- 难点
    1. 
- 友商
    1. 

### 8. 安全审计
- 背景
    - 
- 问题
    - 
- 解决
    - 
- 特点
    1. 
- 使用
    1. 
- 难点
    1. 
- 友商
    1. 

### 9. 数据发现
- 背景
    - 
- 问题
    - 
- 解决
    - 
- 特点
    1. 
- 使用
    1. 
- 难点
    1. 
- 友商
    1. 

### 10. 数据防篡改
- 背景
    - 应用将数据发送给数据库后，数据库在磁盘存储用户数据
- 问题
    - 与透明加密的原理大概一致，如果攻击者绕过数据库，直接篡改磁盘上的数据，可导致数据不一致。
- 解决
    - 用户插入、更新、删除数据时，同事生成一条操作与数据的哈希值，将哈希值记录在系统表中
    - 攻击者篡改数据后，根据系统表中记录的哈希值，可检测检测数据是否被篡改，同时能恢复数据
- 特点
    1. 既能检测篡改，又能恢复数据
- 使用
    1. 创建防篡改Schema
    2. 创建防篡改表
    3. 向表中存储数据，内核自动生成一条记录，数据、操作、数据与操作的哈希
- 难点
    1. 专利：删除、新增的哈希值
- 友商
    1. 

### 11. 数据脱敏
- 背景
    - 
- 问题
    - 
- 解决
    - 
- 特点
    1. 
- 使用
    1. 
- 难点
    1. 
- 友商
    1. 

## 二、1000+产品问题
1. 白盒代码问题：内存泄露、空指针应用
2. 提权问题：新增SQL语句，未调用权限控制函数；调用权限控制的地方不对，存在绕过的情况
3. 功能问题：执行某个功能，报错，需判断报错属于哪个模块

## 三、10+子模块
1. 数据库驱动 libpq
2. 语法解析
3. 语义分析
4. 计划生成
5. 计划执行
6. 存储接口 heapam
7. 索引
8. 事务
9. 共享缓冲区 Buffer
10. 空闲空间管理 FSM
11. 页面管理 Page
12. 预写日志 Wal
13. PageWrite
14. Checkpointer
15. 主备同步
16. 故障恢复
17. 其他：内存管理

# 4 项目经历
## 一、透明加密

## 二、密态数据库


## 三、netfiltere防火墙
- 4类静态包过滤：
    - 协议类型：ICMP, IGMP、TCP, UDP
    - IP：源IP、目的IP
    - TCP：源端口、目的端口
    - 
- 2类动态包过滤：
    - 某个IP的访问速率、访问总数
    - 系统最大连接数
- 1种欺骗
    - ARP欺骗
        - 是否接受到大量ARP包
        - 网关的IP与MAC对应关系是否发生改变
- 11种信息采集
    - 主机状态
        1. ICMP Echo攻击：发送ICMP Echo包，如果回复，则主机开启
        2. Non-Echo ICMP：发送其他类型的ICMP包，如果回复，则主机开启
        3. IP异常包头：发送异常IP包（无效字段、错误分片、静止分片），判断主机返回信息
    - 操作系统版本
        1. TCP ISN取样：向目标主机多次握手，多次取样返回的ISN
        2. ICMP包错误信息发送速率：向目标主机连续发送大量icmp错误包
        3. ICP消息引用：向目标主机发送ICMP错误包，判断返回的错误引用长度
    - 端口
        1. TCP 连接（开放）：tcp三次握手后，tcp反向ident协议可查看：对方进程pid和角色
        2. TCP SYN（半开放）：发送tcp syn包，端口关闭：返回rst，开启：返回syn+ack
        3. TCP FIN（隐蔽）：发送fin包，关闭：返回rst，开启：无返回
        4. TCP Xmax（隐蔽）：发送fin、urg、push标记的包，关闭：返回rst，开启：返回
        5. TCP NULL （隐蔽）：发送关闭无标记包
        6. FTP PROXY （隐藏）：请求ftp服务向目标主机建立连接
        7. UDP：发送UDP包，关闭：ICMP port unreachable，开启：无返回
- 6种DOS
    - 基于系统漏洞
        - ping of death：构造超长ICMP包，受害系统无法识别此类异常，未分配足够内存
        - tear drop：构造重复的IP分片包，受害系统合并分片时，导致越界
    - 基于软件漏洞
    - 基于协议漏洞
    - 基于有限资源
        - smurf：构造ICMP ECHO请求，src_addr设置为受害机地址，在目标网络广播，每台主机都会向受害机回复ICMP REPLAY
        - tcp syn flood：构造TCP SYN请求，使受害机保留大量半开TCP连接
        - tcp syn land：构造TCP SYN请求，src_addr和dst_addr都是受害机，受害机自己与自己建立半开连接
        - http flood：构造大量HTTP GET请求

## 四、国密网盘
- 客户端
    - tkinter
- 服务端
    - 存储：客户端，上传文件
    - 读取：客户端，下载文件
- 传输
    - 非标国密SSL
- 数据加密传输
- 口令身份认证
- 加密文件数据与元信息
    ```python
    receive()
        if 'file info':
            read('file info')
            decrypt('file info')
        elif 'file'
            read('file info')
            decrypt('file info')
            read('file')
            decrypt('file')
    ```
- 支持线程池

## 五、kkdb

# 5 能力范围
1. 操作系统：进程线程、内存管理、IO
    ok
2. 计算机网络：HTTP / TCP / IP / SOCKET
    ok
3. 编程能力：函数执行、汇编、编译、leetcode
4. 密码学：aes, rsa, ssl, pki
5. 网络安全：欺骗、扫描、dos、netfilter
    ok
6. 数据库

# 6 实习经历

# 7 技能爱好
防火墙：
支持4种静态、2种动态的3级与4级包过滤功能；支持检测与预防1种欺骗，3+3+5种信息采集，6种DOS攻击。
源IP、目标IP
源端口、目标端口
源IP速率
整体发送速率

# 8 Leetcode

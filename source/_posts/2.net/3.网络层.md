---
title: 计算机网络 3 网络层
date: 2023-01-01 16:03:37
categories:
    - 计算机网络
tags:
    - 计算机网络
---

- ping的过程
- 路由器与交换机区别

- 网络层
    - 功能
        - 网络互联
    - 问题
        如何通过中继路由器，在复杂网络中到达指定网络
        ```bash
        R：路由器   N：网络 
              [ N1 ] -> R2 -> [ N3 ]
        R1 ->
              [ N2 ] -> R3 -> [ N4 ]
        ```
    - 路由记录
        R1路由表
        | 目的网络 | 下一条路由器 |
        |-|-|
        | N3 | R2 |
        | N4 | R3 |
    - 对比
        - 两种思路对比
            | 场景 | 虚电路 | 数据报 |
            |-|-|-|
            | 建立连接 | 是 | 否 |
            | 分组转发 | 属于同一条虚电路的分组，均由同一路由转发 | 每个分组独立选择路由器 |
            | 故障场景 | 经过故障节点的链路失效 | 经过故障节点的分组失效，触发路由变化 |
            | 分组顺序 | 按照顺序 | 不按照顺序 |
    - IPV4协议：无连接，不可靠
        - IPV4地址
            - 结构
                [网络号][主机号]
            - 分类
                ```bash
                    头部        8       8       8       8           范围
                            +-------+-----------------------+     
                A类 0       | 网络号 |         主机号        |      1-126
                B类 10      |     网络号    |     主机号     |      128-191
                C类 110     |        网络号         | 主机号 |      193-223
                D类 1110    |           多播地址             |
                E类 1111    |                               |
                            +-------------------------------+
                ```
            - IPV4 子网
                - 问题
                    - 新增网络时，路由表扩大，降低效率
                    - IP地址不够灵活
                - 新的IP结构
                    将主机号分解位：子网号 + 主机号
                    [网络号][子网号][主机号]
                - 优点
                    - 减少IP地址浪费
                    - 网络更加灵活
                - 子网掩码
                    - 主机号被拆分，但无法确认具体的子网号占多少位
                    > IP & 子网掩码 -> 网络号与子网号保留，主机号清0
                - 默认子网掩码
                    全是255和0：255.0.0.0  255.255.0.0 ...
        - 格式
            ```python
                4          4           8                    16          
            +-------+----------+--------------+------------------------------+
            | 版本号 | 首部长度 | 服务类型      |           总长度              |
            |          标识符                  | 标志 | 片偏移                 |
            | 存活时间TTL       |   协议       |        首部校验和              |
            |               源IP地址                                          |
            |               目的IP地址                                        |
            |       可变选项长度                | 填充                         |
            +-----------------------------------------------------------------+
            | 数据                                                             |
            ```
        - 内容
            - 版本：IPV4-4 IPV6-6
            - 首部长度：
            - 服务类型：
            - 存活时间TTL:跳数计数器，没经过一个路由器，-1。避免报文永久存在
            - 协议：
    - ARP协议 地址解析协议 Address Resolution Protol
        - 功能：根据IP地址获取MAC地址
            ARP表
            | IP | MAC | 过期时间 | 类型 |
            |-|-|-|-|
            | ip1 | mac1 | xxx s | 动态 |
            | ip2 | mac2 | xxx s | 静态 |
        - 步骤
            ```bash
            主机A                                                  主机B
            | 1.拥有B的IP，准备向B发送数据                    
            | 2.根据IP，查找本地ARP缓存，找到MAC地址
            | 3.如果无缓存，广播ARP请求报文 [A的IP][A的MAC][B的IP] -> |
                                                                | [如果AB不在同一网段，网关先查找缓存，找不到的话广播ARP请求
                                                                | 4.如果报文中是自己IP，存储[A的IP][A的MAC]
            |                        <- 5. 向A单播ARP响应 [B的MAC]  | 
            | 6.将B的MAC存入自己的ARP缓存
            ```
        - ARP报文
            ```bash

                16                      16
            +--------------------+-------------------+
            | 硬件类型            |       协议类型    |
            | 硬件长度 | 协议长度 |  操作码           |
            |   源硬件地址                           | （可变长度，由协议长度决定）
            |   源逻辑地址                           |
            |   目的硬件地址                         |
            |   目的逻辑地址                         |
            +---------------------------------------+
            ```
            - 硬件类型：以太网-1
            - 协议类型：IPV4-0800
            - 硬件长度：以太网-6
            - 协议长度：IPV4-4
            - 操作码：请求-1，响应-2
    - RARP协议 逆地址解析协议 Reverse Address Resolution Protocal
        - 功能：机器向网关查询自己的IP地址
        - 步骤：
            1. 主机发送RARP广播，声明自己的MAC地址
            2. RARP服务器接收请求后，查找本地RARP列表，向源主机发送MAC的IP地址
        
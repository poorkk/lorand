---
title: 数据库 安全机制
date: 2022-09-25 16:03:37
categories:
    - 数据库
tags:
    - postgresql
---

# 1 数据库安全机制
## 1.1 数据库安全机制概述
数据库提供多种安全机制，保证数据的机密性、完整性和可用性。一些常见的安全机制有：
1. 身份认证：基于IP、证书、密码
2. 访问控制：
3. 数据脱敏：查询脱敏、日志脱敏
4. 数据防篡改：账本数据库
5. 数据加密：全密态、透明加密、SSL
6. 安全审计：审计、统一审计

# 2 身份认证
数据库运行时，为避免非法用户访问数据库，造成数据损坏、数据泄露等问题，需采用身份认证机制，阻拦非法用户访问数据库。
身份认证分为标识与鉴别，标识指如何定义合法用户与非法用户，鉴别指根据用户标识判断用户身份。
数据库在建立连接阶段提供三层身份认证机制。

## 2.1 基于IP的身份认证
标识：访问者的IP
鉴别：数据库遍历IP白名单，判断访问者IP是否在白名单中，如果在，则认为访问者合法，允许与数据建立TCP连接。
```c
ServerLoop
    ConnCreate
        StreamConnection
    BackendStartup
        BackendRun
            PostgresMain
                InitPostgres
                    PerformAuthentication
                        ClientAuthentication
                            hba_getauthmethod
                                check_hba
                                    check_hostname
                                    check_ip
                                    /* 如果指定ip未获取到认证方式，则返回空 */
                            switch hba->auth_method: /* 根据ip采用不同的认证方式 */
                                case uaReject:
                                case uaImplicitReject:
                                case uaGSS:
                                case uaSSPI:
                                case uaPeer:
                                ...
                                case uaMD5:
                                case uaPassword:
                                case uaCert:
                                case uaTrust:
                                ...
```

## 2.2 基于证书的身份认证
通常，应用与数据库通信时，先采用SSL协议建立安全的通信信道。在建立SSL阶段，数据库可要求应用提供证书，数据库验证应用证书后，才与其建立SSL连接。该场景中，身份标识即证书，身份鉴别即校验证书的合法性。
标识：证书
鉴别：数据库使用CA的公钥，判断访问者的证书是否由CA签名，如果是，则认为访问者合法，允许与数据建立SSL连接


## 2.3 基于密码的身份认证
应用与数据库建立连接后，还需再进行一次身份认证。身份标识即数据库用户与密码，身份鉴别即判断用户与密码是否匹配。
标识：用户与密码
鉴别：数据库访问pg_role系统表，判断访问者的密码哈希是否与系统表中的密码哈希一致，如果是，则认为访问者合法，允许与数据库建立会话。

# 3 访问控制
访问控制的模型是：主体、客体、操作。
在数据库中，主体指数据库用户，客体指数据对象，操作指用户执行的SQL语句。

# 4 数据脱敏

#
计算机网络：
操作系统：
数据库：
C语言：
数据结构与算法：
密码学：
网络安全：
系统安全：
数据库内核：
其他：了解计算机体系结构、汇编语言、编译原理等。
